# çŒœçŒœçœ‹

> [ch02-00-guessing-game-tutorial.md](https://github.com/rust-lang/book/blob/master/second-edition/src/ch02-00-guessing-game-tutorial.md)
> <br>
> commit 2e269ff82193fd65df8a87c06561d74b51ac02f7

è®“æˆ‘å€‘ä¸€èµ·å‹•æ‰‹å®Œæˆä¸€å€‹é …ç›®ï¼Œä¾†å¿«é€Ÿä¸Šæ‰‹ Rustï¼æœ¬ç« å°‡ä»‹ç´¹ Rust ä¸­å¸¸ç”¨çš„ä¸€äº›æ¦‚å¿µï¼Œä¸¦é€šéçœŸå¯¦çš„ç¨‹åºä¾†å±•ç¤ºå¦‚ä½•é‹ç”¨ä»–å€‘ã€‚ä½ å°‡æœƒå­¸åˆ°æ›´å¤šè«¸å¦‚ `let`ã€`match`ã€æ–¹æ³•(methods)ã€é—œè¯å‡½æ•¸(associated functions)ã€å¤–éƒ¨ crate ç­‰å¾ˆå¤šçš„çŸ¥è­˜ï¼å¾Œç¹¼ç« ç¯€æœƒæ·±å…¥æ¢ç´¢é€™äº›æ¦‚å¿µçš„ç´°ç¯€ã€‚åœ¨é€™ä¸€ç« ï¼Œæˆ‘å€‘å°‡ç·´ç¿’åŸºç¤ã€‚

æˆ‘å€‘æœƒå¯¦ç¾ä¸€å€‹ç¶“å…¸çš„æ–°æ‰‹ç·¨ç¨‹å•é¡Œï¼šçŒœçŒœçœ‹éŠæˆ²ã€‚å®ƒæ˜¯é€™éº¼å·¥ä½œçš„ï¼šç¨‹åºå°‡æœƒéš¨æ©Ÿç”Ÿæˆä¸€å€‹ 1 åˆ° 100 ä¹‹é–“çš„éš¨æ©Ÿæ•´æ•¸ã€‚æ¥è‘—å®ƒæœƒè«‹ç©å®¶çŒœä¸€å€‹æ•¸ä¸¦è¼¸å…¥ï¼Œç„¶å¾Œæç¤ºçŒœæ¸¬æ˜¯å¤§äº†é‚„æ˜¯å°äº†ã€‚å¦‚æœçŒœå°äº†ï¼Œå®ƒæœƒæ‰“å°ç¥è³€ä¿¡æ¯ä¸¦é€€å‡ºã€‚

## æº–å‚™ä¸€å€‹æ–°é …ç›®

è¦å‰µå»ºä¸€å€‹æ–°é …ç›®ï¼Œé€²å…¥ç¬¬ä¸€ç« ä¸­å‰µå»ºçš„ *projects* ç›®éŒ„ï¼Œä½¿ç”¨ Cargo æ–°å»ºä¸€å€‹é …ç›®ï¼Œå¦‚ä¸‹ï¼š

```text
$ cargo new guessing_game --bin
$ cd guessing_game
```

ç¬¬ä¸€å€‹å‘½ä»¤ï¼Œ`cargo new`ï¼Œå®ƒæŠ“å–é …ç›®çš„åç¨±ï¼ˆ`guessing_game`ï¼‰ä½œç‚ºç¬¬ä¸€å€‹åƒæ•¸ã€‚`--bin` åƒæ•¸å‘Šè¨´ Cargo å‰µå»ºä¸€å€‹äºŒé€²åˆ¶é …ç›®ï¼Œèˆ‡ç¬¬ä¸€ç« é¡ä¼¼ã€‚ç¬¬äºŒå€‹å‘½ä»¤é€²å…¥åˆ°æ–°å‰µå»ºçš„é …ç›®ç›®éŒ„ã€‚

çœ‹çœ‹ç”Ÿæˆçš„ *Cargo.toml* æ–‡ä»¶ï¼š

<span class="filename">æ–‡ä»¶å: Cargo.toml</span>

```toml
[package]
name = "guessing_game"
version = "0.1.0"
authors = ["Your Name <you@example.com>"]

[dependencies]
```

å¦‚æœ Cargo å¾ç’°å¢ƒä¸­æŠ“å–çš„é–‹ç™¼è€…ä¿¡æ¯ä¸æ­£ç¢ºï¼Œä¿®æ”¹é€™å€‹æ–‡ä»¶ä¸¦å†æ¬¡ä¿å­˜ã€‚

æ­£å¦‚ç¬¬ä¸€ç« é‚£æ¨£ï¼Œ`cargo new` ç”Ÿæˆäº†ä¸€å€‹ ã€ŒHello, world!ã€ ç¨‹åºã€‚æŸ¥çœ‹ *src/main.rs* æ–‡ä»¶ï¼š

<span class="filename">æ–‡ä»¶å: src/main.rs</span>

```rust
fn main() {
    println!("Hello, world!");
}
```

ç¾åœ¨ç·¨è­¯ ã€ŒHello, world!ã€ ç¨‹åºï¼Œä½¿ç”¨ `cargo run` ç·¨è­¯é‹è¡Œä¸€æ­¥åˆ°ä½ï¼š

```text
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
     Running `target/debug/guessing_game`
Hello, world!
```

`run` å‘½ä»¤é©åˆç”¨æ–¼éœ€è¦å¿«é€Ÿè¿­ä»£çš„é …ç›®ï¼Œè€Œé€™å€‹éŠæˆ²ä¾¿æ˜¯é€™æ¨£çš„é …ç›®ï¼šæˆ‘å€‘éœ€è¦åœ¨ä¸‹ä¸€æ­¥è¿­ä»£ä¹‹å‰å¿«é€Ÿæ¸¬è©¦ã€‚

é‡æ–°æ‰“é–‹ *src/main.rs* æ–‡ä»¶ã€‚æˆ‘å€‘å°‡æœƒåœ¨é€™å€‹æ–‡ä»¶ä¸­ç·¨å¯«å…¨éƒ¨ä»£ç¢¼ã€‚

## è™•ç†ä¸€æ¬¡çŒœæ¸¬

ç¨‹åºçš„ç¬¬ä¸€éƒ¨åˆ†è«‹æ±‚å’Œè™•ç†ç”¨æˆ¶è¼¸å…¥ï¼Œä¸¦æª¢æŸ¥è¼¸å…¥æ˜¯å¦ç¬¦åˆé æœŸçš„æ ¼å¼ã€‚é¦–å…ˆï¼Œå…è¨±ç”¨æˆ¶è¼¸å…¥çŒœæ¸¬ã€‚åœ¨ *src/main.rs* ä¸­è¼¸å…¥ç¤ºä¾‹ 2-1 ä¸­çš„ä»£ç¢¼ã€‚

<span class="filename">æ–‡ä»¶å: src/main.rs</span>

```rust
use std::io;

fn main() {
    println!("Guess the number!");

    println!("Please input your guess.");

    let mut guess = String::new();

    io::stdin().read_line(&mut guess)
        .expect("Failed to read line");

    println!("You guessed: {}", guess);
}
```

<span class="caption">ç¤ºä¾‹ 2-1ï¼šæŠ“å–ç”¨æˆ¶çŒœæ¸¬ä¸¦æ‰“å°çš„ä»£ç¢¼</span>

é€™äº›ä»£ç¢¼åŒ…å«å¾ˆå¤šä¿¡æ¯ï¼Œæˆ‘å€‘ä¸€é»ä¸€é»åœ°éä¸€éã€‚ç‚ºäº†æŠ“å–ç”¨æˆ¶è¼¸å…¥ä¸¦æ‰“å°çµæœä½œç‚ºè¼¸å‡ºï¼Œæˆ‘å€‘éœ€è¦å°‡ `io`ï¼ˆè¼¸å…¥/è¼¸å‡ºï¼‰åº«å¼•å…¥ç•¶å‰ä½œç”¨åŸŸã€‚`io` åº«ä¾†è‡ªæ–¼æ¨™æº–åº«ï¼ˆä¹Ÿè¢«ç¨±ç‚º`std`ï¼‰ï¼š

```rust
use std::io;
```

Rust é è¨­åªåœ¨æ¯å€‹ç¨‹åºçš„ [*prelude*][prelude]<!-- ignore --> ä¸­å¼•å…¥å°‘é‡é¡å‹ã€‚å¦‚æœéœ€è¦çš„é¡å‹ä¸åœ¨ prelude ä¸­ï¼Œä½ å¿…é ˆä½¿ç”¨ä¸€å€‹ `use` èªå¥é¡¯å¼çš„å°‡å…¶å¼•å…¥ä½œç”¨åŸŸã€‚`std::io` åº«æä¾›å¾ˆå¤š `io` ç›¸é—œçš„åŠŸèƒ½ï¼Œæ¯”å¦‚æ¥å—ç”¨æˆ¶è¼¸å…¥ã€‚
(è­¯è¨»: prelude å¯æƒ³æˆpreload, ä¹Ÿå°±é å…ˆè¼‰å…¥è‹¥å¹²åŠŸèƒ½ï¼Œé€™äº›åŠŸèƒ½å¿…ç„¶æ˜¯éå¸¸å¸¸ç”¨çš„)
[prelude]: https://doc.rust-lang.org/std/prelude/index.html

å¦‚ç¬¬ä¸€ç« æ‰€æåŠï¼Œ`main` å‡½æ•¸æ˜¯ç¨‹åºçš„å…¥å£é»ï¼š

```rust
fn main() {
```

`fn` èªæ³•è²æ˜äº†ä¸€å€‹æ–°å‡½æ•¸ï¼Œ`()` è¡¨æ˜æ²’æœ‰åƒæ•¸ï¼Œ`{` ä½œç‚ºå‡½æ•¸é«”çš„é–‹å§‹ã€‚

ç¬¬ä¸€ç« ä¹ŸæåŠäº† `println!` æ˜¯ä¸€å€‹åœ¨å±å¹•ä¸Šæ‰“å°å­—ç¬¦ä¸²çš„å·¨é›†ï¼š

```rust
println!("Guess the number!");

println!("Please input your guess.");
```

é€™äº›ä»£ç¢¼åƒ…åƒ…æ‰“å°æç¤ºï¼Œä»‹ç´¹éŠæˆ²çš„å…§å®¹ç„¶å¾Œè«‹æ±‚ç”¨æˆ¶è¼¸å…¥ã€‚

### ä½¿ç”¨è®Šæ•¸å„²å­˜å€¼

æ¥ä¸‹ä¾†ï¼Œå‰µå»ºä¸€å€‹åœ°æ–¹å„²å­˜ç”¨æˆ¶è¼¸å…¥ï¼Œåƒé€™æ¨£ï¼š

```rust
let mut guess = String::new();
```

ç¾åœ¨ç¨‹åºé–‹å§‹è®Šå¾—æœ‰æ„æ€äº†ï¼é€™ä¸€å°è¡Œä»£ç¢¼ç™¼ç”Ÿäº†å¾ˆå¤šäº‹ã€‚æ³¨æ„é€™æ˜¯ä¸€å€‹ `let` èªå¥ï¼Œç”¨ä¾†å‰µå»º **è®Šæ•¸**ã€‚é€™è£¡æ˜¯å¦å¤–ä¸€å€‹ä¾‹å­ï¼š

```rust
let foo = bar;
```

é€™è¡Œä»£ç¢¼æ–°å»ºäº†ä¸€å€‹å«åš `foo` çš„è®Šæ•¸ä¸¦æŠŠå®ƒç¶å®šåˆ°å€¼ `bar` ä¸Šã€‚åœ¨ Rust ä¸­ï¼Œè®Šæ•¸é è¨­æ˜¯ä¸å¯è®Šçš„ã€‚ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨è®Šæ•¸åå‰ä½¿ç”¨ `mut` ä¾†ä½¿ä¸€å€‹è®Šæ•¸å¯è®Šï¼š

```rust
let foo = 5; // immutable
let mut bar = 5; // mutable
```

> æ³¨æ„ï¼š`//` èªæ³•é–‹å§‹ä¸€å€‹æŒçºŒåˆ°æœ¬è¡Œçš„çµå°¾çš„è¨»é‡‹ã€‚Rust å¿½ç•¥è¨»é‡‹ä¸­çš„æ‰€æœ‰å…§å®¹ã€‚

ç¾åœ¨æˆ‘å€‘çŸ¥é“äº† `let mut guess` æœƒå¼•å…¥ä¸€å€‹å«åš `guess` çš„å¯è®Šè®Šæ•¸ã€‚ç­‰è™Ÿï¼ˆ`=`ï¼‰çš„å³é‚Šæ˜¯ `guess` æ‰€ç¶å®šçš„å€¼ï¼Œå®ƒæ˜¯ `String::new()` çš„çµæœï¼Œé€™å€‹å‡½æ•¸æœƒè¿”å›ä¸€å€‹ `String` çš„æ–°å¯¦ä¾‹ã€‚[`String`][string]<!-- ignore --> æ˜¯ä¸€å€‹æ¨™æº–åº«æä¾›çš„å­—ç¬¦ä¸²é¡å‹ï¼Œå®ƒæ˜¯ UTF-8 ç·¨ç¢¼çš„å¯å¢é•·æ–‡æœ¬å¡Šã€‚(ä½†rust çš„é¡å‹ä¸æ˜¯ç”¨`class`é—œéµå­—è²æ˜ï¼Œæˆ‘å€‘æœƒåœ¨å¾Œé¢çš„ç« ç¯€è¿°æ˜ã€‚)

[string]: https://doc.rust-lang.org/std/string/struct.String.html

`::new` çš„ `::` (é›™å†’è™Ÿ)èªæ³•è¡¨æ˜ `new` æ˜¯ `String` é¡å‹çš„ä¸€å€‹ **é—œè¯å‡½æ•¸**ï¼ˆ*associated function*ï¼‰ã€‚é—œè¯å‡½æ•¸æ˜¯é‡å°é¡å‹å¯¦ç¾çš„ï¼Œåœ¨é€™å€‹ä¾‹å­ä¸­æ˜¯ `String`ï¼Œè€Œä¸æ˜¯ `String` çš„æŸå€‹ç‰¹å®šå¯¦ä¾‹ã€‚ä¸€äº›èªè¨€ä¸­æŠŠå®ƒç¨±ç‚º **éœæ…‹æ–¹æ³•**ï¼ˆ*static method*ï¼‰ã€‚

`new` å‡½æ•¸å‰µå»ºäº†ä¸€å€‹æ–°çš„ç©º `String`ï¼Œä½ æœƒåœ¨å¾ˆå¤šé¡å‹ä¸Šç™¼ç¾ `new` å‡½æ•¸ï¼Œé€™æ˜¯å‰µå»ºé¡å‹å¯¦ä¾‹çš„æ…£ç”¨å‡½æ•¸åã€‚

ç¸½çµä¸€ä¸‹ï¼Œ`let mut guess = String::new();` é€™ä¸€è¡Œå‰µå»ºäº†ä¸€å€‹å¯è®Šè®Šæ•¸ï¼Œç•¶å‰å®ƒç¶å®šåˆ°ä¸€å€‹æ–°çš„ `String` ç©ºå¯¦ä¾‹ä¸Šã€‚

å›æ†¶ä¸€ä¸‹ï¼Œæˆ‘å€‘åœ¨ç¨‹åºçš„ç¬¬ä¸€è¡Œä½¿ç”¨ `use std::io;` å¾æ¨™æº–åº«ä¸­å¼•å…¥äº†è¼¸å…¥/è¼¸å‡ºåŠŸèƒ½ã€‚ç¾åœ¨èª¿ç”¨ `io` çš„é—œè¯å‡½æ•¸ `stdin`ï¼š

```rust
io::stdin().read_line(&mut guess)
    .expect("Failed to read line");
```

å¦‚æœç¨‹åºçš„é–‹é ­æ²’æœ‰ `use std::io` é€™ä¸€è¡Œï¼Œå¯ä»¥æŠŠå‡½æ•¸èª¿ç”¨å¯«æˆ `std::io::stdin`ã€‚`stdin` å‡½æ•¸è¿”å›ä¸€å€‹  [`std::io::Stdin`][iostdin]<!-- ignore --> çš„å¯¦ä¾‹ï¼Œé€™ä»£è¡¨çµ‚ç«¯æ¨™æº–è¼¸å…¥å¥æŸ„çš„é¡å‹ã€‚

[iostdin]: https://doc.rust-lang.org/std/io/struct.Stdin.html

ä»£ç¢¼çš„ä¸‹ä¸€éƒ¨åˆ†ï¼Œ`.read_line(&mut guess)`ï¼Œèª¿ç”¨ [`read_line`][read_line]<!-- ignore --> æ–¹æ³•å¾æ¨™æº–è¼¸å…¥å¥æŸ„æŠ“å–ç”¨æˆ¶è¼¸å…¥ã€‚æˆ‘å€‘é‚„å‘ `read_line()` å‚³éäº†ä¸€å€‹åƒæ•¸ï¼š`&mut guess`ã€‚

[read_line]: https://doc.rust-lang.org/std/io/struct.Stdin.html#method.read_line

`read_line` çš„å·¥ä½œæ˜¯ï¼Œç„¡è«–ç”¨æˆ¶åœ¨æ¨™æº–è¼¸å…¥ä¸­éµå…¥ä»€éº¼å…§å®¹ï¼Œéƒ½å°‡å…¶å­˜å…¥ä¸€å€‹å­—ç¬¦ä¸²ä¸­ï¼Œå› æ­¤å®ƒéœ€è¦å­—ç¬¦ä¸²ä½œç‚ºåƒæ•¸ã€‚é€™å€‹å­—ç¬¦ä¸²åƒæ•¸æ‡‰è©²æ˜¯å¯è®Šçš„ï¼Œä»¥ä¾¿ `read_line` å°‡ç”¨æˆ¶è¼¸å…¥é™„åŠ ä¸Šå»ã€‚

`&` è¡¨ç¤ºé€™å€‹åƒæ•¸æ˜¯ä¸€å€‹ **å¼•ç”¨**ï¼ˆ*reference*ï¼‰ï¼Œå®ƒå…è¨±å¤šè™•ä»£ç¢¼è¨ªå•åŒä¸€è™•æ•¸æ“šï¼Œè€Œç„¡éœ€åœ¨å…§å­˜ä¸­å¤šæ¬¡æ‹·è²ã€‚å¼•ç”¨æ˜¯ä¸€å€‹è¤‡é›œçš„ç‰¹æ€§ï¼ŒRust çš„ä¸€å€‹ä¸»è¦å„ªå‹¢å°±æ˜¯å®‰å…¨è€Œç°¡å–®çš„æ“ç¸±å¼•ç”¨ã€‚ç›®å‰æˆ‘å€‘ä¸éœ€è¦ç­è§£å¦‚æ­¤å¤šç´°ç¯€ï¼šç¬¬å››ç« æœƒæ›´å…¨é¢çš„è§£é‡‹å¼•ç”¨ã€‚ç¾åœ¨ï¼Œæˆ‘å€‘åªéœ€çŸ¥é“å®ƒåƒè®Šæ•¸ä¸€æ¨£ï¼Œé è¨­æ˜¯ä¸å¯è®Šçš„ï¼Œéœ€è¦å¯«æˆ `&mut guess` è€Œä¸æ˜¯ `&guess` ä¾†ä½¿å…¶å¯è®Šã€‚

æˆ‘å€‘é‚„æ²’æœ‰åˆ†æå®Œé€™è¡Œä»£ç¢¼ã€‚é›–ç„¶é€™æ˜¯å–®ç¨ä¸€è¡Œä»£ç¢¼ï¼Œä½†å®ƒæ˜¯ä¸€å€‹é‚è¼¯è¡Œï¼ˆé›–ç„¶æ›è¡Œäº†ä½†ä»æ˜¯ä¸€å€‹èªå¥ï¼‰çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚ç¬¬äºŒéƒ¨åˆ†æ˜¯é€™å€‹æ–¹æ³•ï¼š

```rust
.expect("Failed to read line");
```

ç•¶ä½¿ç”¨ `.foo()` èªæ³•èª¿ç”¨æ–¹æ³•æ™‚ï¼Œé€šéæ›è¡Œä¸¦ç¸®é€²ä¾†æŠŠé•·è¡Œæ‹†é–‹ï¼Œæ˜¯æ˜æ™ºçš„ã€‚æˆ‘å€‘å®Œå…¨å¯ä»¥é€™æ¨£å¯«ï¼š

```rust
io::stdin().read_line(&mut guess).expect("Failed to read line");
```

ä¸éï¼Œéé•·çš„è¡Œé›£ä»¥é–±è®€ï¼Œæ‰€ä»¥æœ€å¥½æ‹†é–‹ä¾†å¯«ï¼Œå…©è¡Œä»£ç¢¼å…©å€‹æ–¹æ³•èª¿ç”¨ã€‚ç¾åœ¨ä¾†çœ‹çœ‹é€™è¡Œä»£ç¢¼å¹¹äº†ä»€éº¼ã€‚

### ä½¿ç”¨ `Result` é¡å‹ä¾†è™•ç†æ½›åœ¨çš„éŒ¯èª¤

ä¹‹å‰æåˆ°äº† `read_line` å°‡ç”¨æˆ¶è¼¸å…¥é™„åŠ åˆ°å‚³éçµ¦å®ƒçš„å­—ç¬¦ä¸²ä¸­ï¼Œä¸éå®ƒä¹Ÿè¿”å›ä¸€å€‹å€¼â€”â€”åœ¨é€™å€‹ä¾‹å­ä¸­(çš„é¡å‹)æ˜¯ [`io::Result`][ioresult]<!-- ignore -->ã€‚Rust æ¨™æº–åº«ä¸­æœ‰å¾ˆå¤šå«åš `Result` çš„é¡å‹ã€‚ä¸€å€‹ [`Result`][result]<!-- ignore --> æ³›å‹ä»¥åŠå°æ‡‰å­æ¨¡çµ„çš„ç‰¹å®šç‰ˆæœ¬ï¼Œæ¯”å¦‚ `io::Result`ã€‚

[ioresult]: https://doc.rust-lang.org/std/io/type.Result.html
[result]: https://doc.rust-lang.org/std/result/enum.Result.html

`Result` é¡å‹æ˜¯ [*æšèˆ‰*ï¼ˆ*enumerations*ï¼‰][enums]<!-- ignore -->ï¼Œé€šå¸¸ä¹Ÿå¯«ä½œ *enums*ã€‚æšèˆ‰é¡å‹æŒæœ‰å›ºå®šé›†åˆçš„å€¼ï¼Œé€™äº›å€¼è¢«ç¨±ç‚ºæšèˆ‰çš„ **æˆå“¡**ï¼ˆ*variants*ï¼‰ã€‚ç¬¬å…­ç« å°‡ä»‹ç´¹æšèˆ‰çš„æ›´å¤šç´°ç¯€ã€‚

[enums]: ch06-00-enums.html

å°æ–¼ `Result`ï¼Œå®ƒçš„æˆå“¡æ˜¯ `Ok` æˆ– `Err`ï¼Œ`Ok` è¡¨ç¤ºæ“ä½œæˆåŠŸï¼Œå…§éƒ¨åŒ…å«æˆåŠŸæ™‚ç”¢ç”Ÿçš„å€¼ã€‚`Err` æ„å‘³è‘—æ“ä½œå¤±æ•—ï¼ŒåŒ…å«å¤±æ•—çš„å‰å› å¾Œæœã€‚

é€™äº› `Result` é¡å‹çš„ä½œç”¨æ˜¯(**åæ‡‰**)ç·¨ç¢¼éŒ¯èª¤è™•ç†ä¿¡æ¯ã€‚`Result` é¡å‹çš„å€¼ï¼Œåƒå…¶ä»–é¡å‹ä¸€æ¨£ï¼Œæ“æœ‰å®šç¾©æ–¼å…¶ä¸Šçš„æ–¹æ³•ã€‚`io::Result` çš„å¯¦ä¾‹æ“æœ‰ [`expect` æ–¹æ³•][expect]<!-- ignore -->ã€‚å¦‚æœ `io::Result` å¯¦ä¾‹çš„å€¼æ˜¯ `Err`ï¼Œ`expect` æœƒå°è‡´ç¨‹åºå´©æ½°ï¼Œä¸¦é¡¯ç¤ºç•¶åšåƒæ•¸å‚³éçµ¦ `expect` çš„ä¿¡æ¯ã€‚å¦‚æœ `read_line` æ–¹æ³•è¿”å› `Err`ï¼Œå‰‡å¯èƒ½æ˜¯ä¾†æºæ–¼åº•å±¤æ“ä½œç³»çµ±éŒ¯èª¤çš„çµæœã€‚å¦‚æœ `io::Result` å¯¦ä¾‹çš„å€¼æ˜¯ `Ok`ï¼Œ`expect` æœƒæŠ“å– `Ok` ä¸­çš„å€¼ä¸¦åŸæ¨£è¿”å›ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œé€™å€‹å€¼æ˜¯ç”¨æˆ¶è¼¸å…¥åˆ°æ¨™æº–è¼¸å…¥ä¸­çš„å­—ç¯€çš„æ•¸é‡ã€‚

[expect]: https://doc.rust-lang.org/std/result/enum.Result.html#method.expect

å¦‚æœä¸ä½¿ç”¨ `expect`ï¼Œç¨‹åºä¹Ÿèƒ½ç·¨è­¯ï¼Œä¸éæœƒå‡ºç¾ä¸€å€‹è­¦å‘Šï¼š

```text
$ cargo build
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
src/main.rs:10:5: 10:39 warning: unused result which must be used,
#[warn(unused_must_use)] on by default
src/main.rs:10     io::stdin().read_line(&mut guess);
                   ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
```

Rust è­¦å‘Šæˆ‘å€‘æ²’æœ‰ä½¿ç”¨ `read_line` çš„è¿”å›å€¼ `Result`ï¼Œèªªæ˜æœ‰ä¸€å€‹å¯èƒ½çš„éŒ¯èª¤æ²’æœ‰è™•ç†ã€‚æƒ³æ¶ˆé™¤è­¦å‘Šï¼Œå°±è€å¯¦çš„å¯«éŒ¯èª¤è™•ç†ï¼Œä¸éæˆ‘å€‘å°±æ˜¯å¸Œæœ›ç¨‹åºåœ¨å‡ºç¾å•é¡Œæ™‚ç«‹å³å´©æ½°ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨ `expect`ã€‚ç¬¬ä¹ç« æœƒå­¸ç¿’å¦‚ä½•å¾éŒ¯èª¤ä¸­æ¢å¾©ã€‚

### ä½¿ç”¨ `println!` ä½”ä½ç¬¦æ‰“å°å€¼

é™¤äº†ä½æ–¼çµå°¾çš„å¤§æ‹¬è™Ÿï¼Œç›®å‰ç‚ºæ­¢å°±åªæœ‰ä¸€è¡Œä»£ç¢¼å€¼å¾—è¨è«–ä¸€ä¸‹äº†ï¼Œå°±æ˜¯é€™ä¸€è¡Œï¼š

```rust
println!("You guessed: {}", guess);
```

é€™è¡Œä»£ç¢¼æ‰“å°å­˜å„²ç”¨æˆ¶è¼¸å…¥çš„å­—ç¬¦ä¸²ã€‚ç¬¬ä¸€å€‹åƒæ•¸æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œè£¡é¢çš„ `{}` æ˜¯é ç•™åœ¨ç‰¹å®šä½ç½®çš„ä½”ä½ç¬¦ã€‚ä½¿ç”¨ `{}` ä¹Ÿå¯ä»¥æ‰“å°å¤šå€‹å€¼ï¼šç¬¬ä¸€å° `{}` ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¹‹å¾Œçš„ç¬¬ä¸€å€‹å€¼ï¼Œç¬¬äºŒå°å‰‡ä½¿ç”¨ç¬¬äºŒå€‹å€¼ï¼Œä¾æ­¤é¡æ¨ã€‚èª¿ç”¨ä¸€æ¬¡ `println!` æ‰“å°å¤šå€‹å€¼çœ‹èµ·ä¾†åƒé€™æ¨£ï¼š

```rust
let x = 5;
let y = 10;

println!("x = {} and y = {}", x, y);
```

é€™è¡Œä»£ç¢¼æœƒæ‰“å°å‡º `x = 5 and y = 10`ã€‚

### æ¸¬è©¦ç¬¬ä¸€éƒ¨åˆ†ä»£ç¢¼

è®“æˆ‘å€‘ä¾†æ¸¬è©¦ä¸‹çŒœçŒœçœ‹éŠæˆ²çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚ä½¿ç”¨ `cargo run` é‹è¡Œï¼š

```text
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
     Running `target/debug/guessing_game`
Guess the number!
Please input your guess.
6
You guessed: 6
```

è‡³æ­¤ç‚ºæ­¢ï¼ŒéŠæˆ²çš„ç¬¬ä¸€éƒ¨åˆ†å·²ç¶“å®Œæˆï¼šæˆ‘å€‘å¾éµç›¤æŠ“å–è¼¸å…¥ä¸¦æ‰“å°äº†å‡ºä¾†ã€‚

## ç”Ÿæˆä¸€å€‹ç§˜å¯†æ•¸å­—

æ¥ä¸‹ä¾†ï¼Œéœ€è¦ç”Ÿæˆä¸€å€‹ç§˜å¯†æ•¸å­—ï¼Œå¥½è®“ç”¨æˆ¶ä¾†çŒœã€‚ç§˜å¯†æ•¸å­—æ‡‰è©²æ¯æ¬¡éƒ½ä¸åŒï¼Œé€™æ¨£é‡è¤‡ç©æ‰ä¸æœƒä¹å‘³ï¼›ç¯„åœæ‡‰è©²åœ¨ 1 åˆ° 100 ä¹‹é–“ï¼Œé€™æ¨£æ‰ä¸æœƒå¤ªå›°é›£ã€‚Rust æ¨™æº–åº«ä¸­å°šæœªåŒ…å«éš¨æ©Ÿæ•¸åŠŸèƒ½ã€‚ç„¶è€Œï¼ŒRust åœ˜éšŠé‚„æ˜¯æä¾›äº†ä¸€å€‹ [`rand` crate][randcrate]ã€‚

[randcrate]: https://crates.io/crates/rand

### ä½¿ç”¨ crate ä¾†å¢åŠ æ›´å¤šåŠŸèƒ½

è¨˜ä½ *crate* æ˜¯ä¸€å€‹ Rust ä»£ç¢¼çš„åŒ…ã€‚æˆ‘å€‘æ­£åœ¨æ§‹å»ºçš„é …ç›®æ˜¯ä¸€å€‹**äºŒé€²åˆ¶ crate**ï¼Œå®ƒç”Ÿæˆä¸€å€‹å¯åŸ·è¡Œæ–‡ä»¶ã€‚ `rand` crate æ˜¯ä¸€å€‹ **åº« crate**ï¼Œåº« crate å¯ä»¥åŒ…å«ä»»æ„èƒ½è¢«å…¶ä»–ç¨‹åºä½¿ç”¨çš„ä»£ç¢¼ã€‚

Cargo å°å¤–éƒ¨ crate çš„é‹ç”¨æ˜¯å…¶äº®é»ã€‚åœ¨æˆ‘å€‘ä½¿ç”¨ `rand` ç·¨å¯«ä»£ç¢¼ä¹‹å‰ï¼Œéœ€è¦ç·¨è¼¯ *Cargo.toml* ï¼Œè²æ˜ `rand` ä½œç‚ºä¸€å€‹ä¾è³´ã€‚ç¾åœ¨æ‰“é–‹é€™å€‹æ–‡ä»¶ä¸¦åœ¨åº•éƒ¨çš„ `[dependencies]` æ®µè½æ¨™é¡Œä¹‹ä¸‹æ·»åŠ ï¼š

<span class="filename">æ–‡ä»¶å: Cargo.toml</span>

```toml
[dependencies]

rand = "0.3.14"
```

åœ¨ *Cargo.toml* æ–‡ä»¶ä¸­ï¼Œæ¨™é¡Œä»¥åŠä¹‹å¾Œçš„å…§å®¹å±¬åŒä¸€å€‹æ®µè½ï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€å€‹æ¨™é¡Œæ‰é–‹å§‹æ–°çš„æ®µè½ã€‚`[dependencies]` æ®µè½å‘Šè¨´ Cargo æœ¬é …ç›®ä¾è³´äº†å“ªäº›å¤–éƒ¨ crate åŠå…¶ç‰ˆæœ¬ã€‚æœ¬ä¾‹ä¸­ï¼Œæˆ‘å€‘ä½¿ç”¨èªç¾©åŒ–ç‰ˆæœ¬ `0.3.14` ä¾†æŒ‡å®š `rand` crateã€‚Cargo ç†è§£[èªç¾©åŒ–ç‰ˆæœ¬ï¼ˆSemantic Versioningï¼‰][semver]<!-- ignore -->ï¼ˆæœ‰æ™‚ä¹Ÿç¨±ç‚º *SemVer*ï¼‰ï¼Œé€™æ˜¯ä¸€ç¨®å®šç¾©ç‰ˆæœ¬è™Ÿçš„æ¨™æº–ã€‚`0.3.14` äº‹å¯¦ä¸Šæ˜¯ `^0.3.14` çš„ç°¡å¯«ï¼Œå®ƒè¡¨ç¤º ã€Œä»»ä½•èˆ‡ 0.3.14 ç‰ˆæœ¬å…¬æœ‰ API ç›¸å…¼å®¹çš„ç‰ˆæœ¬ã€ã€‚

[semver]: http://semver.org

ç¾åœ¨ï¼Œä¸ä¿®æ”¹ä»»ä½•ä»£ç¢¼ï¼Œæ§‹å»ºé …ç›®ï¼Œå¦‚ç¤ºä¾‹ 2-2 æ‰€ç¤ºï¼š

```text
$ cargo build
    Updating registry `https://github.com/rust-lang/crates.io-index`
 Downloading rand v0.3.14
 Downloading libc v0.2.14
   Compiling libc v0.2.14
   Compiling rand v0.3.14
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
```

<span class="caption">ç¤ºä¾‹ 2-2: å¢åŠ  rand crate ä½œç‚ºä¾è³´ä¹‹å¾Œé‹è¡Œ `cargo build` çš„è¼¸å‡º</span>

å¯èƒ½æœƒå‡ºç¾ä¸åŒçš„ç‰ˆæœ¬è™Ÿï¼ˆå¤šè™§äº†èªç¾©åŒ–ç‰ˆæœ¬ï¼Œå®ƒå€‘èˆ‡ä»£ç¢¼æ˜¯å…¼å®¹çš„ï¼ï¼‰ï¼ŒåŒæ™‚é¡¯ç¤ºé †åºä¹Ÿå¯èƒ½æœƒæœ‰æ‰€ä¸åŒã€‚

ç¾åœ¨æˆ‘å€‘æœ‰äº†ä¸€å€‹å¤–éƒ¨ä¾è³´ï¼ŒCargo å¾ *registry* ä¸ŠæŠ“å–æ‰€æœ‰åŒ…çš„æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯ï¼Œé€™æ˜¯ä¸€ä»½ä¾†è‡ª [Crates.io][cratesio] çš„æ•¸æ“šæ‹·è²ã€‚Crates.io æ˜¯ Rust ç”Ÿæ…‹ç’°å¢ƒä¸­çš„é–‹ç™¼è€…å€‘å‘ä»–äººè²¢ç» Rust é–‹æºé …ç›®çš„åœ°æ–¹ã€‚

[cratesio]: https://crates.io

åœ¨æ›´æ–°å®Œ registry å¾Œï¼ŒCargo æª¢æŸ¥ `[dependencies]` æ®µè½ä¸¦ä¸‹è¼‰ç¼ºå¤±çš„éƒ¨åˆ†ã€‚æœ¬ä¾‹ä¸­ï¼Œé›–ç„¶åªè²æ˜äº† `rand` ä¸€å€‹ä¾è³´ï¼Œç„¶è€Œ Cargo é‚„æ˜¯é¡å¤–æŠ“å–äº† `libc` çš„æ‹·è²ï¼Œå› ç‚º `rand` ä¾è³´ `libc` ä¾†æ­£å¸¸å·¥ä½œã€‚ä¸‹è¼‰å®Œæˆå¾Œï¼ŒRust ç·¨è­¯ä¾è³´ï¼Œç„¶å¾Œä½¿ç”¨é€™äº›ä¾è³´ç·¨è­¯é …ç›®ã€‚

å¦‚æœä¸åšä»»ä½•ä¿®æ”¹ï¼Œç«‹åˆ»å†æ¬¡é‹è¡Œ `cargo build`ï¼Œå‰‡ä¸æœƒæœ‰ä»»ä½•è¼¸å‡ºã€‚Cargo çŸ¥é“å®ƒå·²ç¶“ä¸‹è¼‰ä¸¦ç·¨è­¯äº†ä¾è³´ï¼ŒåŒæ™‚ *Cargo.toml* æ–‡ä»¶ä¹Ÿæ²’æœ‰è®Šå‹•ã€‚Cargo é‚„çŸ¥é“ä»£ç¢¼ä¹Ÿæ²’æœ‰ä»»ä½•ä¿®æ”¹ï¼Œæ‰€ä»¥å®ƒä¸æœƒé‡æ–°ç·¨è­¯ä»£ç¢¼ã€‚å› ç‚ºç„¡äº‹å¯åšï¼Œå®ƒç°¡å–®çš„é€€å‡ºäº†ã€‚å¦‚æœæ‰“é–‹ *src/main.rs* æ–‡ä»¶ï¼Œåšä¸€äº›ç„¡é—œç·Šè¦çš„ä¿®æ”¹ï¼Œä¿å­˜ä¸¦å†æ¬¡æ§‹å»ºï¼Œåªæœƒå‡ºç¾ä¸€è¡Œè¼¸å‡ºï¼š

```text
$ cargo build
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
```

é€™ä¸€è¡Œè¡¨ç¤º Cargo åªé‡å° *src/main.rs* æ–‡ä»¶çš„å¾®å°ä¿®æ”¹è€Œæ›´æ–°æ§‹å»ºã€‚ä¾è³´æ²’æœ‰è®ŠåŒ–ï¼Œæ‰€ä»¥ Cargo çŸ¥é“å®ƒå¯ä»¥å¾©ç”¨å·²ç¶“ç‚ºæ­¤ä¸‹è¼‰ä¸¦ç·¨è­¯çš„ä»£ç¢¼ã€‚å®ƒåªæ˜¯é‡æ–°æ§‹å»ºäº†éƒ¨åˆ†ï¼ˆé …ç›®ï¼‰ä»£ç¢¼ã€‚

#### *Cargo.lock* æ–‡ä»¶ç¢ºä¿æ§‹å»ºæ˜¯å¯é‡ç¾çš„

Cargo æœ‰ä¸€å€‹æ©Ÿåˆ¶ä¾†ç¢ºä¿ä»»ä½•äººåœ¨ä»»ä½•æ™‚å€™é‡æ–°æ§‹å»ºä»£ç¢¼ï¼Œéƒ½æœƒç”¢ç”Ÿç›¸åŒçš„çµæœï¼šCargo åªæœƒä½¿ç”¨ä½ æŒ‡å®šçš„ä¾è³´çš„ç‰ˆæœ¬ï¼Œé™¤éä½ åˆæ‰‹å‹•æŒ‡å®šäº†åˆ¥çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸‹å‘¨ `rand` crate çš„ `v0.3.15` ç‰ˆæœ¬å‡ºä¾†äº†ï¼Œå®ƒä¿®å¾©äº†ä¸€å€‹é‡è¦çš„ bugï¼ŒåŒæ™‚ä¹Ÿå«æœ‰ä¸€å€‹ç¼ºé™·ï¼Œæœƒç ´å£ä»£ç¢¼çš„é‹è¡Œï¼Œé€™æ™‚æœƒç™¼ç”Ÿä»€éº¼å‘¢ï¼Ÿ

é€™å€‹å•é¡Œçš„ç­”æ¡ˆæ˜¯ *Cargo.lock* æ–‡ä»¶ã€‚å®ƒåœ¨ç¬¬ä¸€æ¬¡é‹è¡Œ `cargo build` æ™‚å‰µå»ºï¼Œä¸¦æ”¾åœ¨ *guessing_game* ç›®éŒ„ã€‚ç•¶ç¬¬ä¸€æ¬¡æ§‹å»ºé …ç›®æ™‚ï¼ŒCargo è¨ˆç®—å‡ºæ‰€æœ‰ç¬¦åˆè¦æ±‚çš„ä¾è³´ç‰ˆæœ¬ä¸¦å¯«å…¥ *Cargo.lock* æ–‡ä»¶ã€‚ç•¶å°‡ä¾†æ§‹å»ºé …ç›®æ™‚ï¼ŒCargo æœƒç™¼ç¾ *Cargo.lock* å­˜åœ¨ä¸¦ä½¿ç”¨å…¶ä¸­æŒ‡å®šçš„ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯å†æ¬¡è¨ˆç®—æ‰€æœ‰çš„ç‰ˆæœ¬ã€‚é€™ä½¿å¾—ä½ æ“æœ‰äº†ä¸€å€‹è‡ªå‹•åŒ–çš„å¯é‡ç¾çš„æ§‹å»ºã€‚æ›å¥è©±èªªï¼Œé …ç›®æœƒæŒçºŒä½¿ç”¨ `0.3.14` ç›´åˆ°ä½ é¡¯å¼å‡ç´šï¼Œæ„Ÿè¬ *Cargo.lock* æ–‡ä»¶ã€‚

#### æ›´æ–° crate åˆ°ä¸€å€‹æ–°ç‰ˆæœ¬

ç•¶ä½  **ç¢ºå¯¦** éœ€è¦å‡ç´š crate æ™‚ï¼ŒCargo æä¾›äº†å¦ä¸€å€‹å‘½ä»¤ï¼Œ`update`ï¼Œä»–æœƒï¼š

1. å¿½ç•¥ *Cargo.lock* æ–‡ä»¶ï¼Œä¸¦è¨ˆç®—å‡ºæ‰€æœ‰ç¬¦åˆ *Cargo.toml* è²æ˜çš„æœ€æ–°ç‰ˆæœ¬ã€‚
2. å¦‚æœæˆåŠŸäº†ï¼ŒCargo æœƒæŠŠé€™äº›ç‰ˆæœ¬å¯«å…¥ *Cargo.lock* æ–‡ä»¶ã€‚

ä¸éï¼ŒCargo é è¨­åªæœƒå°‹æ‰¾å¤§æ–¼ `0.3.0` è€Œå°æ–¼ `0.4.0` çš„ç‰ˆæœ¬ã€‚å¦‚æœ `rand` crate ç™¼ä½ˆäº†å…©å€‹æ–°ç‰ˆæœ¬ï¼Œ`0.3.15` å’Œ `0.4.0`ï¼Œåœ¨é‹è¡Œ `cargo update` æ™‚æœƒå‡ºç¾å¦‚ä¸‹å…§å®¹ï¼š

```text
$ cargo update
    Updating registry `https://github.com/rust-lang/crates.io-index`
    Updating rand v0.3.14 -> v0.3.15
```

é€™æ™‚ï¼Œä½ ä¹Ÿæœƒæ³¨æ„åˆ°çš„ *Cargo.lock* æ–‡ä»¶ä¸­çš„è®ŠåŒ–ç„¡å¤–ä¹ `rand` crate ç¾åœ¨ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯`0.3.15`

å¦‚æœæƒ³è¦ä½¿ç”¨ `0.4.0` ç‰ˆæœ¬çš„ `rand` æˆ–æ˜¯ä»»ä½• `0.4.x` ç³»åˆ—çš„ç‰ˆæœ¬ï¼Œå¿…é ˆåƒé€™æ¨£æ›´æ–° *Cargo.toml* æ–‡ä»¶ï¼š

```toml
[dependencies]

rand = "0.4.0"
```

ä¸‹ä¸€æ¬¡é‹è¡Œ `cargo build` æ™‚ï¼ŒCargo æœƒå¾ registry æ›´æ–°å¯ç”¨çš„ crateï¼Œä¸¦æ ¹æ“šä½ æŒ‡å®šçš„æ–°ç‰ˆæœ¬é‡æ–°è¨ˆç®—ã€‚

ç¬¬åå››ç« æœƒè¬›åˆ° [Cargo][doccargo]<!-- ignore --> åŠå…¶[ç”Ÿæ…‹ç³»çµ±][doccratesio]<!-- ignore -->çš„æ›´å¤šå…§å®¹ï¼Œä¸éç›®å‰ä½ åªéœ€è¦ç­è§£é€™éº¼å¤šã€‚é€šé Cargo å¾©ç”¨åº«æ–‡ä»¶éå¸¸å®¹æ˜“ï¼Œå› æ­¤ Rustacean èƒ½å¤ ç·¨å¯«å‡ºç”±å¾ˆå¤šåŒ…çµ„è£è€Œæˆçš„æ›´è¼•å·§çš„é …ç›®ã€‚

[doccargo]: http://doc.crates.io
[doccratesio]: http://doc.crates.io/crates-io.html

### ç”Ÿæˆä¸€å€‹éš¨æ©Ÿæ•¸

è®“æˆ‘å€‘é–‹å§‹ **ä½¿ç”¨** `rand`ã€‚ä¸‹ä¸€æ­¥æ˜¯æ›´æ–° *src/main.rs*ï¼Œå¦‚ç¤ºä¾‹ 2-3 æ‰€ç¤ºï¼š

<span class="filename">æ–‡ä»¶å: src/main.rs</span>

```rust
extern crate rand;

use std::io;
use rand::{thread_rng, Rng};

fn main() {
    println!("Guess the number!");

    let secret_number = rand::thread_rng().gen_range(1, 101);

    println!("The secret number is: {}", secret_number);

    println!("Please input your guess.");

    let mut guess = String::new();

    io::stdin().read_line(&mut guess)
        .expect("Failed to read line");

    println!("You guessed: {}", guess);
}
```

<span class="caption">ç¤ºä¾‹ 2-3ï¼šç‚ºäº†ç”Ÿæˆéš¨æ©Ÿæ•¸è€Œåšçš„ä¿®æ”¹</span>

é€™è£¡åœ¨é ‚éƒ¨å¢åŠ ä¸€è¡Œ `extern crate rand;` é€šçŸ¥ Rust æˆ‘å€‘è¦ä½¿ç”¨å¤–éƒ¨ä¾è³´ã€‚é€™ä¹Ÿæœƒèª¿ç”¨ç›¸æ‡‰çš„ `use rand`ï¼Œæ‰€ä»¥ç¾åœ¨å¯ä»¥ä½¿ç”¨ `rand::` å‰ç¶´ä¾†èª¿ç”¨ `rand` crate ä¸­çš„ä»»ä½•å…§å®¹ã€‚

æ¥ä¸‹ä¾†å¢åŠ äº†å¦ä¸€è¡Œ `use`ï¼š`use rand::Rng`ã€‚`Rng` æ˜¯ä¸€å€‹ traitï¼Œå®ƒå®šç¾©äº†éš¨æ©Ÿæ•¸ç”Ÿæˆå™¨æ‡‰å¯¦ç¾çš„æ–¹æ³•(traitå…¶å¯¦æœ‰é»åƒä»‹é¢)ï¼Œæƒ³ä½¿ç”¨é€™äº›æ–¹æ³•çš„è©±æ­¤ trait å¿…é ˆåœ¨ä½œç”¨åŸŸä¸­ã€‚ç¬¬åç« æœƒè©³ç´°ä»‹ç´¹ traitã€‚

å¦å¤–ï¼Œä¸­é–“é‚„æ–°å¢åŠ äº†å…©è¡Œã€‚`rand::thread_rng` å‡½æ•¸æä¾›å¯¦éš›ä½¿ç”¨çš„éš¨æ©Ÿæ•¸ç”Ÿæˆå™¨ï¼šå®ƒä½æ–¼ç•¶å‰åŸ·è¡Œç·šç¨‹ï¼Œä¸¦å¾æ“ä½œç³»çµ±æŠ“å– seedã€‚æ¥ä¸‹ä¾†ï¼Œèª¿ç”¨éš¨æ©Ÿæ•¸ç”Ÿæˆå™¨çš„ `gen_range` æ–¹æ³•ã€‚é€™å€‹æ–¹æ³•ç”±å‰›æ‰å¼•å…¥åˆ°ä½œç”¨åŸŸçš„ `Rng` trait å®šç¾©(æˆ‘å€‘åœ¨ä»£ç¢¼ä¸Šå¾ˆé›£ç›´æ¥çœ‹å‡ºé€™ç¨®å‰å¾Œå› æœï¼Œå› ç‚ºä»£ç¢¼ä¸­å…¶å¯¦æ²’æœ‰å¯«å‡º`Rng`ã€‚)ã€‚`gen_range` æ–¹æ³•æŠ“å–å…©å€‹æ•¸å­—ä½œç‚ºåƒæ•¸ï¼Œä¸¦ç”Ÿæˆä¸€å€‹ç¯„åœåœ¨å…©è€…ä¹‹é–“çš„éš¨æ©Ÿæ•¸ã€‚å®ƒåŒ…å«ä¸‹é™ä½†ä¸åŒ…å«ä¸Šé™ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®š `1` å’Œ `101` ä¾†è«‹æ±‚ä¸€å€‹ 1 å’Œ 100 ä¹‹é–“çš„æ•¸ã€‚
(è­¯è¨»:å¦ä¸€ç¨®å¯«æ³•
```rust
extern crate rand;

use std::io;
use rand::{thread_rng, Rng};

fn main() {
    println!("Guess the number!");

    let secret_number = thread_rng().gen_range(1, 101);

    println!("The secret number is: {}", secret_number);

    println!("Please input your guess.");

    let mut guess = String::new();

    io::stdin().read_line(&mut guess)
        .expect("Failed to read line");

    println!("You guessed: {}", guess);
}
```
æˆ‘ä¸ç¢ºå®šé€™æ¨£å¯«æ˜¯å¦æœƒæ¯”è¼ƒå¥½äº†è§£ï¼ŒåŸä¾†çš„ç‰ˆæœ¬æ˜¯å¯ä»¥ç·¨è­¯ä¸”åŸ·è¡Œçš„ï¼Œä½†å¾ˆé›£çœ‹å‡º`rand::Rng`èˆ‡`rand::thread_rng().gen_range(1, 101);`ä¹‹é–“çš„é—œä¿‚ã€‚é™„ä¸Š[Trait rand::Rng](https://doc.rust-lang.org/rand/rand/trait.Rng.html) é›–ç„¶çœ‹èµ·ä¾†å¾ˆåƒï¼Œä¸”åŸ·è¡Œå¾—åˆ°çš„çµæœä¹Ÿæ˜¯ä¸€æ¨£çš„ï¼Œä½†æœ¬è³ªä¸Šï¼Œé€™æ˜¯ä¸ä¸€æ¨£çš„æ±è¥¿ã€‚)<br>
(è­¯è¨»:ä½¿ç”¨`pub trait rand::Rng` å…§å®šç¾©çš„æ–¹æ³•æ™‚ä¸ç”¨å¯«ä¸Š`Rng`ï¼Œä½†æ˜¯å–®ç¨çš„æ–¹æ³•ä¸èƒ½åŸ·è¡Œï¼Œå¿…é ˆæœ‰å€‹å¯¦ä½œè©²æ–¹æ³•çš„é¡åˆ¥æˆ–å¯¦ä¾‹æ‰èƒ½åŸ·è¡Œï¼Œæ‰€ä»¥åŸä¾†çš„å¯«æ³•æ‰æœƒå¯«æˆé‚£å€‹æ¨£å­ã€‚<br>
ä»£ç¢¼ line:324 `pub trait Rng {çœç•¥}`<br>
ä»£ç¢¼ line:934 `pub fn thread_rng() -> ThreadRng {çœç•¥}`<br>
ä»£ç¢¼ line:950 `impl Rng for ThreadRng {çœç•¥}`<br>
[crate rand çš„ä»£ç¢¼](https://doc.rust-lang.org/rand/src/rand/lib.rs.html)
)

çŸ¥é“ use å“ªå€‹ trait å’Œè©²å¾ crate ä¸­èª¿ç”¨å“ªå€‹æ–¹æ³•ä¸¦ä¸ä»£è¡¨ä½  **çŸ¥é“** å¦‚ä½•ä½¿ç”¨ã€‚crate çš„ä½¿ç”¨èªªæ˜ä½æ–¼å…¶æ–‡æª”ä¸­ã€‚Cargo æœ‰ä¸€å€‹å¾ˆæ£’çš„åŠŸèƒ½æ˜¯ï¼šé‹è¡Œ `cargo doc --open` å‘½ä»¤ä¾†æ§‹å»ºæ‰€æœ‰æœ¬åœ°ä¾è³´æä¾›çš„æ–‡æª”ï¼Œä¸¦åœ¨ç€è¦½å™¨ä¸­æ‰“é–‹ã€‚ä¾‹å¦‚ï¼Œå‡è¨­ä½ å° `rand` crate ä¸­çš„å…¶ä»–åŠŸèƒ½æ„Ÿèˆˆè¶£ï¼Œ`cargo doc --open` ä¸¦é»æ“Šå·¦å´å°èˆªæ¬„ä¸­çš„ `rand`ã€‚

æ–°å¢åŠ çš„ç¬¬äºŒè¡Œä»£ç¢¼æ‰“å°å‡ºäº†ç§˜å¯†æ•¸å­—ã€‚é€™åœ¨é–‹ç™¼ç¨‹åºæ™‚å¾ˆæœ‰ç”¨ï¼Œå› ç‚ºå¯ä»¥æ¸¬è©¦å®ƒï¼Œä¸éåœ¨æœ€çµ‚ç‰ˆæœ¬ä¸­æœƒåˆªæ‰å®ƒã€‚éŠæˆ²ä¸€é–‹å§‹å°±æ‰“å°å‡ºçµæœå°±æ²’ä»€éº¼å¯ç©çš„äº†ï¼

å˜—è©¦é‹è¡Œç¨‹åºå¹¾æ¬¡ï¼š

```text
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
     Running `target/debug/guessing_game`
Guess the number!
The secret number is: 7
Please input your guess.
4
You guessed: 4
$ cargo run
     Running `target/debug/guessing_game`
Guess the number!
The secret number is: 83
Please input your guess.
5
You guessed: 5
```

ä½ æ‡‰è©²èƒ½å¾—åˆ°ä¸åŒçš„éš¨æ©Ÿæ•¸ï¼ŒåŒæ™‚ä»–å€‘æ‡‰è©²éƒ½æ˜¯åœ¨ 1 å’Œ 100 ä¹‹é–“çš„ã€‚å¹¹å¾—æ¼‚äº®ï¼

## æ¯”è¼ƒçŒœæ¸¬èˆ‡ç§˜å¯†æ•¸å­—

ç¾åœ¨æœ‰äº†ç”¨æˆ¶è¼¸å…¥å’Œä¸€å€‹éš¨æ©Ÿæ•¸ï¼Œæˆ‘å€‘å¯ä»¥æ¯”è¼ƒä»–å€‘ã€‚é€™å€‹æ­¥é©Ÿå¦‚ç¤ºä¾‹ 2-4 æ‰€ç¤ºï¼š

<span class="filename">æ–‡ä»¶å: src/main.rs</span>

```rust
// æ³¨æ„ä»¥ä¸‹ä»£ç¢¼ç„¡æ³•é€šéç·¨è­¯
extern crate rand;

use std::io;
use std::cmp::Ordering;
use rand::Rng;

fn main() {
    println!("Guess the number!");

    let secret_number = rand::thread_rng().gen_range(1, 101);

    println!("The secret number is: {}", secret_number);

    println!("Please input your guess.");

    let mut guess = String::new();

    io::stdin().read_line(&mut guess)
        .expect("Failed to read line");

    println!("You guessed: {}", guess);

    match guess.cmp(&secret_number) {  // æ˜¯çš„ï¼Œé€™è£¡çœ‹èµ·ä¾†å¾ˆå¥‡æ€ªï¼Œä½†rust å¤§ç¥å€‘ç‚ºæ‰€æœ‰çš„æ±è¥¿åŠ ä¸Šäº†cmpæ–¹æ³•ï¼Œä¸¦ä¸”æ˜¯`prelude`ã€‚
        Ordering::Less    => println!("Too small!"),
        Ordering::Greater => println!("Too big!"),
        Ordering::Equal   => println!("You win!"),
    }
}
```

<span class="caption">ç¤ºä¾‹ 2-4ï¼šè™•ç†æ¯”è¼ƒå…©å€‹æ•¸å­—å¯èƒ½çš„è¿”å›å€¼</span>

æ–°ä»£ç¢¼çš„ç¬¬ä¸€è¡Œæ˜¯å¦ä¸€å€‹ `use`ï¼Œå¾æ¨™æº–åº«å¼•å…¥äº†ä¸€å€‹å«åš `std::cmp::Ordering` çš„é¡å‹ã€‚`Ordering` æ˜¯ä¸€å€‹åƒ `Result` ä¸€æ¨£çš„æšèˆ‰ï¼Œä¸éå®ƒçš„æˆå“¡æ˜¯ `Less`ã€`Greater` å’Œ `Equal`ã€‚é€™æ˜¯æ¯”è¼ƒå…©å€‹å€¼æ™‚å¯èƒ½å‡ºç¾çš„ä¸‰ç¨®çµæœã€‚

æ¥è‘—ï¼Œåº•éƒ¨çš„äº”è¡Œæ–°ä»£ç¢¼ä½¿ç”¨äº† `Ordering` é¡å‹ï¼š

```rust
match guess.cmp(&secret_number) {   
    Ordering::Less    => println!("Too small!"),
    Ordering::Greater => println!("Too big!"),
    Ordering::Equal   => println!("You win!"),
}
```

`cmp` [æ–¹æ³•å¯ä»¥åœ¨ä»»ä½•å¯æ¯”è¼ƒçš„å€¼ä¸Šèª¿ç”¨](https://doc.rust-lang.org/std/?search=cmp)ã€‚å®ƒæŠ“å–ä¸€å€‹è¢«æ¯”è¼ƒå€¼çš„å¼•ç”¨ï¼šé€™è£¡æ˜¯æŠŠ `guess` èˆ‡ `secret_number` åšæ¯”è¼ƒã€‚ `cmp` è¿”å›ä¸€å€‹å‰›æ‰é€šé `use` å¼•å…¥ä½œç”¨åŸŸçš„ `Ordering` æšèˆ‰çš„æˆå“¡ã€‚æˆ‘å€‘ä½¿ç”¨ä¸€å€‹ [`match`][match]<!-- ignore --> è¡¨é”å¼ï¼Œæ ¹æ“š `guess` èª¿ç”¨ `cmp` å° `&secret_number`é€²è¡Œæ¯”è¼ƒå¾Œè¿”å›çš„ `Ordering` æˆå“¡ä¾†æ±ºå®šæ¥ä¸‹ä¾†åšä»€éº¼ã€‚

[match]: ch06-02-match.html

ä¸€å€‹ `match` è¡¨é”å¼ç”± **åˆ†æ”¯ï¼ˆarmsï¼‰** æ§‹æˆã€‚ä¸€å€‹åˆ†æ”¯åŒ…å«ä¸€å€‹ **æ¨¡å¼**ï¼ˆ*pattern*ï¼‰å’Œè¡¨é”å¼é–‹é ­çš„å€¼èˆ‡åˆ†æ”¯æ¨¡å¼ç›¸åŒ¹é…æ™‚æ‡‰è©²åŸ·è¡Œçš„ä»£ç¢¼(TODO: é€™è£¡å¥½æ€ªè¦å†ä¿®æ”¹)ã€‚Rust æŠ“å–æä¾›çµ¦ `match` çš„å€¼ä¸¦ä¾åºæª¢æŸ¥æ¯å€‹åˆ†æ”¯çš„æ¨¡å¼ã€‚`match` çµæ§‹å’Œæ¨¡å¼æ˜¯ Rust ä¸­å¼·å¤§çš„åŠŸèƒ½ï¼Œå®ƒé«”ç¾äº†ä»£ç¢¼å¯èƒ½é‡åˆ°çš„å¤šç¨®æƒ…å½¢ï¼Œä¸¦å¹«åŠ©ä½ æ²’æœ‰éºæ¼çš„è™•ç†ã€‚é€™äº›åŠŸèƒ½å°‡åˆ†åˆ¥åœ¨ç¬¬å…­ç« å’Œç¬¬åå…«ç« è©³ç´°ä»‹ç´¹ã€‚

è®“æˆ‘å€‘çœ‹çœ‹ä½¿ç”¨ `match` è¡¨é”å¼çš„ä¾‹å­ã€‚å‡è¨­ç”¨æˆ¶çŒœäº† 50ï¼Œé€™æ™‚éš¨æ©Ÿç”Ÿæˆçš„ç§˜å¯†æ•¸å­—æ˜¯ 38ã€‚æ¯”è¼ƒ 50 èˆ‡ 38 æ™‚ï¼Œå› ç‚º 50 æ¯” 38 è¦å¤§ï¼Œ`cmp` æ–¹æ³•æœƒè¿”å› `Ordering::Greater`ã€‚`Ordering::Greater` æ˜¯ `match` è¡¨é”å¼å¾—åˆ°çš„å€¼ã€‚å®ƒæª¢æŸ¥ç¬¬ä¸€å€‹åˆ†æ”¯çš„æ¨¡å¼ï¼Œ`Ordering::Less` èˆ‡ `Ordering::Greater`ä¸¦ä¸åŒ¹é…ï¼Œæ‰€ä»¥å®ƒå¿½ç•¥äº†é€™å€‹åˆ†æ”¯çš„å‹•ä½œä¸¦ä¾†åˆ°ä¸‹ä¸€å€‹åˆ†æ”¯ã€‚ä¸‹ä¸€å€‹åˆ†æ”¯çš„æ¨¡å¼æ˜¯ `Ordering::Greater`ï¼Œ**æ­£ç¢º** åŒ¹é…ï¼é€™å€‹åˆ†æ”¯é—œè¯çš„ä»£ç¢¼è¢«åŸ·è¡Œï¼Œåœ¨å±å¹•æ‰“å°å‡º `Too big!`ã€‚`match` è¡¨é”å¼å°±æ­¤çµ‚æ­¢ï¼Œå› ç‚ºè©²å ´æ™¯ä¸‹æ²’æœ‰æª¢æŸ¥æœ€å¾Œä¸€å€‹åˆ†æ”¯çš„å¿…è¦ã€‚

ç„¶è€Œï¼Œç¤ºä¾‹ 2-4 çš„ä»£ç¢¼ä¸¦ä¸èƒ½ç·¨è­¯ï¼Œå¯ä»¥å˜—è©¦ä¸€ä¸‹ï¼š

```text
$ cargo build
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
error[E0308]: mismatched types
  --> src/main.rs:23:21
   |
23 |     match guess.cmp(&secret_number) {
   |                     ^^^^^^^^^^^^^^ expected struct `std::string::String`, found integral variable
   |
   = note: expected type `&std::string::String`
   = note:    found type `&{integer}`

error: aborting due to previous error
Could not compile `guessing_game`.
```

éŒ¯èª¤çš„æ ¸å¿ƒè¡¨æ˜é€™è£¡æœ‰ **ä¸åŒ¹é…çš„é¡å‹**ï¼ˆ*mismatched types*ï¼‰ã€‚Rust æœ‰ä¸€å€‹éœæ…‹å¼·é¡å‹ç³»çµ±ï¼ŒåŒæ™‚ä¹Ÿæœ‰é¡å‹æ¨æ–·ã€‚ç•¶æˆ‘å€‘å¯«å‡º `let guess = String::new()` æ™‚ï¼ŒRust æ¨æ–·å‡º `guess` æ‡‰è©²æ˜¯ä¸€å€‹`String`ï¼Œä¸éœ€è¦æˆ‘å€‘å¯«å‡ºçš„é¡å‹ã€‚å¦ä¸€æ–¹é¢ï¼Œ`secret_number`ï¼Œæ˜¯ä¸€å€‹æ•¸å­—é¡å‹ã€‚å¤šç¨®æ•¸å­—é¡å‹æ“æœ‰ 1 åˆ° 100 ä¹‹é–“çš„å€¼ï¼š32 ä½æ•¸å­— `i32`ï¼›32 ä½ç„¡ç¬¦è™Ÿæ•¸å­— `u32`ï¼›64 ä½æ•¸å­— `i64` ç­‰ç­‰ã€‚Rust é è¨­ä½¿ç”¨ `i32`ï¼Œæ‰€ä»¥å®ƒæ˜¯ `secret_number` çš„é¡å‹ï¼Œé™¤éå¢åŠ é¡å‹ä¿¡æ¯ï¼Œæˆ–ä»»ä½•èƒ½è®“ Rust æ¨æ–·å‡ºä¸åŒæ•¸å€¼é¡å‹çš„ä¿¡æ¯ã€‚é€™è£¡éŒ¯èª¤çš„åŸå› åœ¨æ–¼ Rust ä¸æœƒæ¯”è¼ƒå­—ç¬¦ä¸²é¡å‹å’Œæ•¸å­—é¡å‹ã€‚

æ‰€ä»¥æˆ‘å€‘å¿…é ˆæŠŠå¾è¼¸å…¥ä¸­è®€å–åˆ°çš„ `String` è½‰æ›ç‚ºä¸€å€‹çœŸæ­£çš„æ•¸å­—é¡å‹ï¼Œæ‰å¥½èˆ‡ç§˜å¯†æ•¸å­—é€²è¡Œæ¯”è¼ƒã€‚é€™å¯ä»¥é€šéåœ¨ `main` å‡½æ•¸é«”ä¸­å¢åŠ å¦‚ä¸‹å…©è¡Œä»£ç¢¼ä¾†å¯¦ç¾ï¼š


<span class="filename">æ–‡ä»¶å: src/main.rs</span>

```rust
extern crate rand;

use std::io;
use std::cmp::Ordering;
use rand::Rng;

fn main() {
    println!("Guess the number!");

    let secret_number = rand::thread_rng().gen_range(1, 101);

    println!("The secret number is: {}", secret_number);

    println!("Please input your guess.");

    let mut guess = String::new();

    io::stdin().read_line(&mut guess)
        .expect("Failed to read line");

    let guess: u32 = guess.trim().parse()
        .expect("Please type a number!");

    println!("You guessed: {}", guess);

    match guess.cmp(&secret_number) {
        Ordering::Less    => println!("Too small!"),
        Ordering::Greater => println!("Too big!"),
        Ordering::Equal   => println!("You win!"),
    }
}
```

é€™å…©è¡Œæ–°ä»£ç¢¼æ˜¯ï¼š

```rust
let guess: u32 = guess.trim().parse()
    .expect("Please type a number!");
```

é€™è£¡å‰µå»ºäº†ä¸€å€‹å«åš `guess` çš„è®Šæ•¸ã€‚ä¸éç­‰ç­‰ï¼Œä¸æ˜¯å·²ç¶“æœ‰äº†ä¸€å€‹å«åš`guess`çš„è®Šæ•¸äº†å—ï¼Ÿç¢ºå¯¦å¦‚æ­¤ï¼Œä¸é Rust å…è¨± **éš±è—**ï¼ˆ*shadow*ï¼‰ï¼Œç”¨ä¸€å€‹æ–°å€¼ä¾†éš±è— `guess` ä¹‹å‰çš„å€¼ã€‚é€™å€‹åŠŸèƒ½å¸¸ç”¨åœ¨éœ€è¦è½‰æ›å€¼é¡å‹ä¹‹é¡çš„å ´æ™¯ï¼Œå®ƒå…è¨±æˆ‘å€‘å¾©ç”¨ `guess` è®Šæ•¸çš„åå­—ï¼Œè€Œä¸æ˜¯è¢«è¿«å‰µå»ºå…©å€‹ä¸åŒè®Šæ•¸ï¼Œè«¸å¦‚ `guess_str` å’Œ `guess` ä¹‹é¡ã€‚ï¼ˆç¬¬ä¸‰ç« æœƒä»‹ç´¹ shadowing çš„æ›´å¤šç´°ç¯€ã€‚ï¼‰

`guess` è¢«ç¶å®šåˆ° `guess.trim().parse()` è¡¨é”å¼ã€‚è¡¨é”å¼ä¸­çš„ `guess` æ˜¯åŒ…å«è¼¸å…¥çš„åŸå§‹ `String` é¡å‹ã€‚`String` å¯¦ä¾‹çš„ `trim` æ–¹æ³•æœƒå»é™¤å­—ç¬¦ä¸²é–‹é ­å’Œçµå°¾çš„ç©ºç™½ã€‚`u32` åªèƒ½ç”±æ•¸å­—å­—ç¬¦è½‰æ›ï¼Œä¸éç”¨æˆ¶å¿…é ˆè¼¸å…¥ <span class="keystroke">return</span> éµæ‰èƒ½è®“ `read_line` è¿”å›ï¼Œç„¶è€Œç”¨æˆ¶æŒ‰ä¸‹ <span class="keystroke">return</span> éµæ™‚ï¼Œæœƒåœ¨å­—ç¬¦ä¸²ä¸­å¢åŠ ä¸€å€‹æ›è¡Œï¼ˆnewlineï¼‰ç¬¦ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ¶è¼¸å…¥ <span class="keystroke">5</span> ä¸¦æŒ‰ä¸‹ <span class="keystroke">return</span>ï¼Œ`guess` çœ‹èµ·ä¾†åƒé€™æ¨£ï¼š`5\n`ã€‚`\n` ä»£è¡¨ ã€Œæ›è¡Œã€ï¼Œå›è»Šéµã€‚`trim` æ–¹æ³•æ¶ˆé™¤ `\n`ï¼Œåªç•™ä¸‹`5`ã€‚

[å­—ç¬¦ä¸²çš„ `parse` æ–¹æ³•][parse]<!-- ignore --> å°‡å­—ç¬¦ä¸²è§£ææˆæ•¸å­—ã€‚å› ç‚ºé€™å€‹æ–¹æ³•å¯ä»¥è§£æå¤šç¨®æ•¸å­—é¡å‹ï¼Œå› æ­¤éœ€è¦å‘Šè¨´ Rust å…·é«”çš„æ•¸å­—é¡å‹ï¼Œé€™è£¡é€šé `let guess: u32` æŒ‡å®šã€‚`guess` å¾Œé¢çš„å†’è™Ÿï¼ˆ`:`ï¼‰å‘Šè¨´ Rust æˆ‘å€‘æŒ‡å®šäº†è®Šæ•¸çš„é¡å‹ã€‚Rust æœ‰ä¸€äº›å…§å»ºçš„æ•¸å­—é¡å‹ï¼›`u32` æ˜¯ä¸€å€‹ç„¡ç¬¦è™Ÿçš„ 32 ä½æ•´å‹ã€‚å°æ–¼ä¸å¤§çš„æ­£æ•´æ•¸ä¾†èªªï¼Œå®ƒæ˜¯ä¸éŒ¯çš„é¡å‹ï¼Œç¬¬ä¸‰ç« é‚„æœƒè¬›åˆ°å…¶ä»–æ•¸å­—é¡å‹ã€‚å¦å¤–ï¼Œç¨‹åºä¸­çš„ `u32` è¨»è§£ä»¥åŠèˆ‡ `secret_number` çš„æ¯”è¼ƒï¼Œæ„å‘³è‘— Rust æœƒæ¨æ–·å‡º `secret_number` ä¹Ÿæ˜¯ `u32` é¡å‹ã€‚ç¾åœ¨å¯ä»¥ä½¿ç”¨ç›¸åŒé¡å‹æ¯”è¼ƒå…©å€‹å€¼äº†ï¼

[parse]: https://doc.rust-lang.org/std/primitive.str.html#method.parse

`parse` èª¿ç”¨å¾ˆå®¹æ˜“ç”¢ç”ŸéŒ¯èª¤ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²ä¸­åŒ…å« `AğŸ‘%`ï¼Œå°±ç„¡æ³•å°‡å…¶è½‰æ›ç‚ºä¸€å€‹æ•¸å­—ã€‚å› æ­¤ï¼Œ`parse` æ–¹æ³•è¿”å›ä¸€å€‹ `Result` é¡å‹ã€‚åƒä¹‹å‰ ã€Œä½¿ç”¨ `Result` é¡å‹ä¾†è™•ç†æ½›åœ¨çš„éŒ¯èª¤ã€ è¨è«–çš„ `read_line` æ–¹æ³•é‚£æ¨£ï¼Œå†æ¬¡æŒ‰éƒ¨å°±ç­çš„ç”¨ `expect` æ–¹æ³•è™•ç†å³å¯ã€‚å¦‚æœ `parse` ä¸èƒ½å¾å­—ç¬¦ä¸²ç”Ÿæˆä¸€å€‹æ•¸å­—ï¼Œè¿”å›ä¸€å€‹ `Result::Err` æ™‚ï¼Œ`expect` æœƒä½¿éŠæˆ²å´©æ½°ä¸¦æ‰“å°é™„å¸¶çš„ä¿¡æ¯(`"Please type a number!"`)ã€‚å¦‚æœ `parse` æˆåŠŸåœ°å°‡å­—ç¬¦ä¸²è½‰æ›ç‚ºä¸€å€‹æ•¸å­—ï¼Œå®ƒæœƒè¿”å› `Result::Ok`ï¼Œç„¶å¾Œ `expect` æœƒè¿”å› `Ok` ä¸­çš„æ•¸å­—ã€‚

ç¾åœ¨è®“æˆ‘å€‘é‹è¡Œç¨‹åºï¼

```text
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
     Running `target/guessing_game`
Guess the number!
The secret number is: 58
Please input your guess.
  76
You guessed: 76
Too big!
```

æ¼‚äº®ï¼å³ä¾¿æ˜¯åœ¨çŒœæ¸¬ä¹‹å‰æ·»åŠ äº†ç©ºæ ¼ï¼Œç¨‹åºä¾ç„¶èƒ½åˆ¤æ–·å‡ºç”¨æˆ¶çŒœæ¸¬äº† 76ã€‚å¤šé‹è¡Œç¨‹åºå¹¾æ¬¡ä¾†æª¢é©—ä¸åŒé¡å‹è¼¸å…¥çš„ç›¸æ‡‰è¡Œç‚ºï¼šçŒœä¸€å€‹æ­£ç¢ºçš„æ•¸å­—ï¼ŒçŒœä¸€å€‹éå¤§çš„æ•¸å­—å’ŒçŒœä¸€å€‹éå°çš„æ•¸å­—ã€‚

ç¾åœ¨éŠæˆ²å·²ç¶“å¤§é«”ä¸Šèƒ½ç©äº†ï¼Œä¸éç”¨æˆ¶åªèƒ½çŒœä¸€æ¬¡ã€‚å¢åŠ ä¸€å€‹å¾ªç’°ä¾†æ”¹è®Šå®ƒå§ï¼

## ä½¿ç”¨å¾ªç’°ä¾†å…è¨±å¤šæ¬¡çŒœæ¸¬

`loop` é—œéµå­—æä¾›äº†ä¸€å€‹ç„¡é™å¾ªç’°ã€‚å°‡å…¶åŠ å…¥å¾Œï¼Œç”¨æˆ¶å¯ä»¥åè¦†çŒœæ¸¬ï¼š

<span class="filename">æ–‡ä»¶å: src/main.rs</span>

```rust
extern crate rand;

use std::io;
use std::cmp::Ordering;
use rand::Rng;

fn main() {
    println!("Guess the number!");

    let secret_number = rand::thread_rng().gen_range(1, 101);

    println!("The secret number is: {}", secret_number);

    loop {
        println!("Please input your guess.");

        let mut guess = String::new();

        io::stdin().read_line(&mut guess)
            .expect("Failed to read line");

        let guess: u32 = guess.trim().parse()
            .expect("Please type a number!");

        println!("You guessed: {}", guess);

        match guess.cmp(&secret_number) {
            Ordering::Less    => println!("Too small!"),
            Ordering::Greater => println!("Too big!"),
            Ordering::Equal   => println!("You win!"),
        }
    }
}
```

å¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘å€‘å°‡æç¤ºç”¨æˆ¶çŒœæ¸¬ä¹‹å¾Œçš„æ‰€æœ‰å…§å®¹æ”¾å…¥äº†å¾ªç’°ã€‚ç¢ºä¿é€™äº›ä»£ç¢¼é¡å¤–ç¸®é€²äº†ä¸€å±¤ï¼Œå†æ¬¡é‹è¡Œç¨‹åºã€‚æ³¨æ„é€™è£¡æœ‰ä¸€å€‹æ–°å•é¡Œï¼Œå› ç‚ºç¨‹åºå¿ å¯¦åœ°åŸ·è¡Œäº†æˆ‘å€‘çš„è¦æ±‚ï¼šæ°¸é åœ°è«‹æ±‚å¦ä¸€å€‹çŒœæ¸¬ï¼Œç”¨æˆ¶å¥½åƒæ²’æ³•é€€å‡ºå•Šï¼

ç”¨æˆ¶ç¸½èƒ½ä½¿ç”¨ <span class="keystroke">ctrl-C</span> çµ‚æ­¢ç¨‹åºã€‚ä¸éé‚„æœ‰å¦ä¸€å€‹æ–¹æ³•è·³å‡ºç„¡é™å¾ªç’°ï¼Œå°±æ˜¯ ã€Œæ¯”è¼ƒçŒœæ¸¬èˆ‡ç§˜å¯†æ•¸å­—ã€ éƒ¨åˆ†æåˆ°çš„ `parse`ï¼šå¦‚æœç”¨æˆ¶è¼¸å…¥ä¸€å€‹éæ•¸å­—ç­”æ¡ˆï¼Œç¨‹åºæœƒå´©æ½°ã€‚ç”¨æˆ¶å¯ä»¥åˆ©ç”¨é€™ä¸€é»ä¾†é€€å‡ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```text
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
     Running `target/guessing_game`
Guess the number!
The secret number is: 59
Please input your guess.
45
You guessed: 45
Too small!
Please input your guess.
60
You guessed: 60
Too big!
Please input your guess.
59
You guessed: 59
You win!
Please input your guess.
quit
thread 'main' panicked at 'Please type a number!: ParseIntError { kind: InvalidDigit }', src/libcore/result.rs:785
note: Run with `RUST_BACKTRACE=1` for a backtrace.
error: Process didn't exit successfully: `target/debug/guess` (exit code: 101)
```

è¼¸å…¥ `quit` ç¢ºå¯¦é€€å‡ºäº†ç¨‹åºï¼ŒåŒæ™‚å…¶ä»–ä»»ä½•éæ•¸å­—è¼¸å…¥ä¹Ÿä¸€æ¨£ã€‚ç„¶è€Œï¼Œé€™ä¸¦ä¸ç†æƒ³ï¼Œæˆ‘å€‘æƒ³è¦ç•¶çŒœæ¸¬æ­£ç¢ºçš„æ•¸å­—æ™‚éŠæˆ²èƒ½è‡ªå‹•é€€å‡ºã€‚

### çŒœæ¸¬æ­£ç¢ºå¾Œé€€å‡º

è®“æˆ‘å€‘å¢åŠ ä¸€å€‹ `break`ï¼Œåœ¨ç”¨æˆ¶çŒœå°æ™‚é€€å‡ºéŠæˆ²ï¼š


<span class="filename">æ–‡ä»¶å: src/main.rs</span>

```rust
extern crate rand;

use std::io;
use std::cmp::Ordering;
use rand::Rng;

fn main() {
    println!("Guess the number!");

    let secret_number = rand::thread_rng().gen_range(1, 101);

    println!("The secret number is: {}", secret_number);

    loop {
        println!("Please input your guess.");

        let mut guess = String::new();

        io::stdin().read_line(&mut guess)
            .expect("Failed to read line");

        let guess: u32 = guess.trim().parse()
            .expect("Please type a number!");

        println!("You guessed: {}", guess);

        match guess.cmp(&secret_number) {
            Ordering::Less    => println!("Too small!"),
            Ordering::Greater => println!("Too big!"),
            Ordering::Equal   => {
                println!("You win!");
                break;
            }
        }
    }
}
```

é€šéåœ¨ `You win!` ä¹‹å¾Œå¢åŠ ä¸€è¡Œ `break`ï¼Œç”¨æˆ¶çŒœå°äº†ç¥ç§˜æ•¸å­—å¾Œæœƒé€€å‡ºå¾ªç’°ã€‚é€€å‡ºå¾ªç’°ä¹Ÿæ„å‘³è‘—é€€å‡ºç¨‹åºï¼Œå› ç‚ºå¾ªç’°æ˜¯ `main` çš„æœ€å¾Œä¸€éƒ¨åˆ†ã€‚

### è™•ç†ç„¡æ•ˆè¼¸å…¥

ç‚ºäº†é€²ä¸€æ­¥æ”¹å–„éŠæˆ²æ€§ï¼Œä¸è¦åœ¨ç”¨æˆ¶è¼¸å…¥éæ•¸å­—æ™‚å´©æ½°ï¼Œéœ€è¦å¿½ç•¥éæ•¸å­—ï¼Œè®“ç”¨æˆ¶å¯ä»¥ç¹¼çºŒçŒœæ¸¬ã€‚å¯ä»¥é€šéä¿®æ”¹ `guess` å°‡ `String` è½‰åŒ–ç‚º `u32` é‚£éƒ¨åˆ†ä»£ç¢¼ä¾†å¯¦ç¾ï¼š

```rust
let guess: u32 = match guess.trim().parse() {
    Ok(num) => num,
    Err(_) => continue,
};
```

å°‡ `expect` èª¿ç”¨æ›æˆ `match` èªå¥ï¼Œæ˜¯å¾é‡åˆ°éŒ¯èª¤å°±å´©æ½°è½‰æ›åˆ°çœŸæ­£è™•ç†éŒ¯èª¤çš„æ…£ç”¨æ–¹æ³•ã€‚é ˆçŸ¥ `parse` è¿”å›ä¸€å€‹ `Result` é¡å‹ï¼Œè€Œ `Result` æ˜¯ä¸€å€‹æ“æœ‰ `Ok` æˆ– `Err` æˆå“¡çš„æšèˆ‰ã€‚é€™è£¡ä½¿ç”¨çš„ `match` è¡¨é”å¼ï¼Œå’Œä¹‹å‰è™•ç† `cmp` æ–¹æ³•è¿”å› `Ordering` æ™‚ç”¨çš„ä¸€æ¨£ã€‚

å¦‚æœ `parse` èƒ½å¤ æˆåŠŸçš„å°‡å­—ç¬¦ä¸²è½‰æ›ç‚ºä¸€å€‹æ•¸å­—ï¼Œå®ƒæœƒè¿”å›ä¸€å€‹åŒ…å«çµæœæ•¸å­—çš„ `Ok`ã€‚é€™å€‹ `Ok` å€¼èˆ‡ `match` ç¬¬ä¸€å€‹åˆ†æ”¯çš„æ¨¡å¼ç›¸åŒ¹é…ï¼Œè©²åˆ†æ”¯å°æ‡‰çš„å‹•ä½œè¿”å› `Ok` å€¼ä¸­çš„æ•¸å­— `num`ï¼Œæœ€å¾Œå¦‚é¡˜è®Šæˆæ–°å‰µå»ºçš„ `guess` è®Šæ•¸ã€‚

å¦‚æœ `parse` *ä¸* èƒ½å°‡å­—ç¬¦ä¸²è½‰æ›ç‚ºä¸€å€‹æ•¸å­—ï¼Œå®ƒæœƒè¿”å›ä¸€å€‹åŒ…å«æ›´å¤šéŒ¯èª¤ä¿¡æ¯çš„ `Err`ã€‚`Err` å€¼ä¸èƒ½åŒ¹é…ç¬¬ä¸€å€‹ `match` åˆ†æ”¯çš„ `Ok(num)` æ¨¡å¼ï¼Œä½†æ˜¯æœƒåŒ¹é…ç¬¬äºŒå€‹åˆ†æ”¯çš„ `Err(_)` æ¨¡å¼ï¼š`_` æ˜¯ä¸€å€‹é€šé…å€¼ï¼Œæœ¬ä¾‹ä¸­ç”¨ä¾†åŒ¹é…æ‰€æœ‰ `Err` å€¼ï¼Œä¸ç®¡å…¶ä¸­æœ‰ä½•ç¨®ä¿¡æ¯ã€‚æ‰€ä»¥ç¨‹åºæœƒåŸ·è¡Œç¬¬äºŒå€‹åˆ†æ”¯çš„å‹•ä½œï¼Œ`continue` æ„å‘³è‘—é€²å…¥ `loop` çš„ä¸‹ä¸€æ¬¡å¾ªç’°ï¼Œè«‹æ±‚å¦ä¸€å€‹çŒœæ¸¬ã€‚é€™æ¨£ç¨‹åºå°±æœ‰æ•ˆçš„å¿½ç•¥äº† `parse` å¯èƒ½é‡åˆ°çš„æ‰€æœ‰éŒ¯èª¤ï¼

ç¾åœ¨è¬äº‹ä¿±å‚™ï¼Œåªéœ€é‹è¡Œ `cargo run`ï¼š

```text
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
     Running `target/guessing_game`
Guess the number!
The secret number is: 61
Please input your guess.
10
You guessed: 10
Too small!
Please input your guess.
99
You guessed: 99
Too big!
Please input your guess.
foo
Please input your guess.
61
You guessed: 61
You win!
```

å¤ªæ£’äº†ï¼å†æœ‰æœ€å¾Œä¸€å€‹å°çš„ä¿®æ”¹ï¼Œå°±èƒ½å®ŒæˆçŒœçŒœçœ‹éŠæˆ²äº†ï¼šé‚„è¨˜å¾—ç¨‹åºä¾ç„¶æœƒæ‰“å°å‡ºç§˜å¯†æ•¸å­—ã€‚åœ¨æ¸¬è©¦æ™‚é‚„å¥½ï¼Œä½†æ­£å¼ç™¼ä½ˆæ™‚æœƒæ¯€äº†éŠæˆ²ã€‚åˆªæ‰æ‰“å°ç§˜å¯†æ•¸å­—çš„ `println!`ã€‚ç¤ºä¾‹ 2-5 ç‚ºæœ€çµ‚ä»£ç¢¼ï¼š

<span class="filename">æ–‡ä»¶å: src/main.rs</span>

```rust
extern crate rand;

use std::io;
use std::cmp::Ordering;
use rand::Rng;

fn main() {
    println!("Guess the number!");

    let secret_number = rand::thread_rng().gen_range(1, 101);

    loop {
        println!("Please input your guess.");

        let mut guess = String::new();

        io::stdin().read_line(&mut guess)
            .expect("Failed to read line");

        let guess: u32 = match guess.trim().parse() {
            Ok(num) => num,
            Err(_) => continue,
        };

        println!("You guessed: {}", guess);

        match guess.cmp(&secret_number) {
            Ordering::Less    => println!("Too small!"),
            Ordering::Greater => println!("Too big!"),
            Ordering::Equal   => {
                println!("You win!");
                break;
            }
        }
    }
}
```

<span class="caption">ç¤ºä¾‹ 2-5ï¼šçŒœçŒœçœ‹éŠæˆ²çš„å®Œæ•´ä»£ç¢¼</span>

## ç¸½çµ

æ­¤æ™‚æ­¤åˆ»ï¼Œä½ é †åˆ©å®Œæˆäº†çŒœçŒœçœ‹éŠæˆ²ï¼æ­å–œï¼

é€™æ˜¯ä¸€å€‹é€šéå‹•æ‰‹å¯¦è¸å­¸ç¿’ Rust æ–°æ¦‚å¿µçš„é …ç›®ï¼š`let`ã€`match`ã€æ–¹æ³•ã€é—œè¯å‡½æ•¸ã€ä½¿ç”¨å¤–éƒ¨ crate ç­‰ç­‰ï¼Œæ¥ä¸‹ä¾†çš„å¹¾ç« ï¼Œæˆ‘å€‘å°‡æœƒç¹¼çºŒæ·±å…¥ã€‚ç¬¬ä¸‰ç« æ¶‰åŠåˆ°å¤§éƒ¨åˆ†ç·¨ç¨‹èªè¨€éƒ½æœ‰çš„æ¦‚å¿µï¼Œæ¯”å¦‚è®Šæ•¸ã€æ•¸æ“šé¡å‹å’Œå‡½æ•¸ï¼Œä»¥åŠå¦‚ä½•åœ¨ Rust ä¸­ä½¿ç”¨ä»–å€‘ã€‚ç¬¬å››ç« æ¢ç´¢æ‰€æœ‰æ¬Šï¼ˆownershipï¼‰ï¼Œé€™æ˜¯ä¸€å€‹ Rust åŒå…¶ä»–èªè¨€å¤§ä¸ç›¸åŒçš„åŠŸèƒ½ã€‚ç¬¬äº”ç« è¨è«–çµæ§‹é«”å’Œæ–¹æ³•çš„èªæ³•ï¼Œè€Œç¬¬å…­ç« å´é‡è§£é‡‹æšèˆ‰ã€‚